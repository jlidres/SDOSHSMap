<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Juan City Schools Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        /* NEW: Styling for the Search Bar container and input */
        .search-container {
            width: 100%;
            max-width: 900px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
        }

        #schoolSearch {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 30px; /* Gives the search bar nice rounded pill-like edges */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color 0.3s;
        }

        #schoolSearch:focus {
            border-color: #1a73e8; /* Highlights blue when clicked */
        }

        #schoolMap {
            height: 550px;
            width: 100%;
            max-width: 900px; 
            border: none;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1); 
            z-index: 1; /* Ensures the map stays behind standard dropdowns */
        }

        .custom-school-icon { display: flex; justify-content: center; align-items: center; font-size: 24px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .leaflet-popup-content-wrapper { border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .leaflet-popup-content { margin: 16px; line-height: 1.5; }
        .popup-title { font-size: 1.1em; color: #1a73e8; margin-bottom: 6px; border-bottom: 1px solid #eee; padding-bottom: 6px; }
        .popup-programs { font-size: 0.9em; color: #555; }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: 600; color: white; margin-bottom: 8px; }
        
        /* Map Legend Styling */
        .info.legend { background: white; padding: 10px 14px; font-size: 14px; line-height: 24px; color: #555; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .info.legend h4 { margin: 0 0 8px 0; color: #333; font-size: 15px; }
        .info.legend i { width: 24px; text-align: center; margin-right: 8px; font-size: 16px; }
    </style>
</head>
<body>

    <h2>Public Schools in San Juan City</h2>
    
    <div class="search-container">
        <input type="text" id="schoolSearch" list="school-options" placeholder="Search for a school...">
        <datalist id="school-options"></datalist>
    </div>

    <div id="schoolMap"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        var map = L.map('schoolMap').setView([14.6042, 121.0300], 14);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var schools = [
            { name: "Nicanor C. Ibuna Elementary School", lat: 14.60176124, lng: 121.0303504, programs: "K-6 Basic Education" },
            { name: "Pedro Cruz Elementary School", lat: 14.60551065, lng: 121.0263512, programs: "K-6 Basic Education" },
            { name: "Pinaglabanan Elementary School", lat: 14.60401922, lng: 121.0299103, programs: "K-6 Basic Education, SPED" },
            { name: "San Perfecto Elementary School", lat: 14.60304465, lng: 121.0231903, programs: "K-6 Basic Education" },
            { name: "Sta. Lucia Elementary School", lat: 14.59785905, lng: 121.0353281, programs: "K-6 Basic Education" },
            { name: "West Crame Elementary School", lat: 14.60803024, lng: 121.0506251, programs: "K-6 Basic Education" },
            { name: "Kabayanan Integrated School", lat: 14.59879668, lng: 121.0316739, programs: "K-10 Integrated Basic Ed." },
            { name: "Salapan Integrated School", lat: 14.6113472, lng: 121.0244919, programs: "K-10 Integrated Basic Ed." },
            { name: "San Juan City Integrated School", lat: 14.60613459, lng: 121.0228738, programs: "K-10 Integrated Basic Ed." },
            { name: "San Juan National High School", lat: 14.60558314, lng: 121.0294749, programs: "Junior High (Grades 7-10)" },
            { name: "San Juan City Science High School", lat: 14.60369204, lng: 121.0314835, programs: "Science Curriculum (JHS & SHS)" },
            { name: "San Juan City Academic Senior High School", lat: 14.60699842, lng: 121.0225635, programs: "SHS Academic Tracks" },
            { name: "San Juan City TVL Senior High School", lat: 14.60327769, lng: 121.0293973, programs: "SHS TVL Tracks" }
        ];

        function getSchoolColor(name) {
            if (name.includes("Elementary")) return "#4285F4"; 
            if (name.includes("High School")) return "#EA4335"; 
            if (name.includes("Integrated")) return "#34A853"; 
            return "#FBBC05"; 
        }

        // Target our HTML elements for the search functionality
        var datalist = document.getElementById('school-options');
        var searchInput = document.getElementById('schoolSearch');

        schools.forEach(function(school) {
            var schoolColor = getSchoolColor(school.name);
            
            var iconHtml = `<i class="fa-solid fa-school" style="color: ${schoolColor};"></i>`;
            var customIcon = L.divIcon({
                html: iconHtml,
                className: 'custom-school-icon',
                iconSize: [30, 30], 
                iconAnchor: [15, 15], 
                popupAnchor: [0, -15] 
            });
            
            var marker = L.marker([school.lat, school.lng], { icon: customIcon }).addTo(map);
            
            var popupContent = `
                <div class='badge' style='background-color: ${schoolColor}'>School Info</div>
                <div class='popup-title'><b>${school.name}</b></div>
                <div class='popup-programs'><b>Programs:</b> ${school.programs}</div>
            `;
            
            marker.bindPopup(popupContent);

            // NEW 1: Store a reference to this specific marker inside our school object 
            // so we can access it later during the search
            school.marker = marker;

            // NEW 2: Add this school's name to the HTML datalist for autocomplete
            var option = document.createElement('option');
            option.value = school.name;
            datalist.appendChild(option);
        });

        // NEW 3: Listen for when the user types or selects an option in the search box
        searchInput.addEventListener('input', function(e) {
            var typedText = e.target.value;
            
            // Search through our array to see if the typed text matches a school name exactly
            var matchedSchool = schools.find(function(s) {
                return s.name === typedText;
            });

            // If we found a match...
            if (matchedSchool) {
                // Fly smoothly to those coordinates, and zoom in closely (zoom level 18)
                map.flyTo([matchedSchool.lat, matchedSchool.lng], 18, {
                    animate: true,
                    duration: 1.5 // Takes 1.5 seconds to glide over
                });
                
                // Automatically open the popup for that school
                matchedSchool.marker.openPopup();
                
                // Clear the search box so it's ready for next time
                searchInput.value = '';
                searchInput.blur(); // Removes the cursor focus from the search box
            }
        });

        // Fetch and draw the San Juan City Border
        var nominatimUrl = "https://nominatim.openstreetmap.org/search.php?q=San+Juan+City,+Metro+Manila,+Philippines&polygon_geojson=1&format=json";
        
        fetch(nominatimUrl)
            .then(function(response) { return response.json(); })
            .then(function(data) {
                if (data && data.length > 0) {
                    var cityBoundary = data[0].geojson;
                    L.geoJSON(cityBoundary, {
                        style: { color: "#2c3e50", weight: 3, opacity: 0.7, fillOpacity: 0.05, dashArray: '8, 6' }
                    }).addTo(map);
                }
            });

        // Create the Map Legend
        var legend = L.control({ position: 'bottomright' });
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = `
                <h4>School Types</h4>
                <i class="fa-solid fa-school" style="color: #4285F4;"></i> Elementary School<br>
                <i class="fa-solid fa-school" style="color: #EA4335;"></i> High School<br>
                <i class="fa-solid fa-school" style="color: #34A853;"></i> Integrated School
            `;
            return div;
        };
        legend.addTo(map);

    </script>

</body>
</html>