<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>San Juan City Schools Map</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 { color: #2c3e50; margin-bottom: 20px; text-align: center; }

        .search-container { width: 100%; max-width: 900px; margin-bottom: 15px; display: flex; justify-content: center; }
        #schoolSearch { width: 100%; max-width: 400px; padding: 12px 20px; font-size: 16px; border: 1px solid #ccc; border-radius: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: 'Inter', sans-serif; outline: none; transition: border-color 0.3s; }
        #schoolSearch:focus { border-color: #1a73e8; }

        #schoolMap { height: 550px; width: 100%; max-width: 900px; border: none; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); z-index: 1; }

        .custom-school-icon { display: flex; justify-content: center; align-items: center; font-size: 24px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .leaflet-popup-content-wrapper { border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .leaflet-popup-content { margin: 16px; line-height: 1.5; }
        .popup-title { font-size: 1.1em; color: #1a73e8; margin-bottom: 4px; border-bottom: 1px solid #eee; padding-bottom: 4px; }
        
        .popup-id { font-size: 0.8em; color: #888; font-family: monospace; margin-bottom: 8px; }
        .popup-address { font-size: 0.85em; color: #666; margin-bottom: 8px; }
        .popup-programs { font-size: 0.9em; color: #555; margin-bottom: 12px; }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: 600; color: white; margin-bottom: 8px; }
        
        /* NEW: Styling to turn our plain link into a nice-looking button */
        .btn-directions {
            display: inline-block;
            width: 100%;
            padding: 8px 0;
            background-color: #1a73e8;
            color: white !important; /* Forces the text to stay white */
            text-decoration: none; /* Removes the underline */
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            transition: background-color 0.2s;
            box-sizing: border-box;
        }
        
        .btn-directions:hover {
            background-color: #1557b0; /* Darkens slightly when hovered over */
        }

        .info.legend { background: white; padding: 10px 14px; font-size: 14px; line-height: 24px; color: #555; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .info.legend h4 { margin: 0 0 8px 0; color: #333; font-size: 15px; }
        .info.legend i { width: 24px; text-align: center; margin-right: 8px; font-size: 16px; }
    </style>
</head>
<body>

    <h2>Public Schools in San Juan City</h2>
    
    <div class="search-container">
        <input type="text" id="schoolSearch" list="school-options" placeholder="Search for a school...">
        <datalist id="school-options"></datalist>
    </div>

    <div id="schoolMap"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        var map = L.map('schoolMap').setView([14.6042, 121.0300], 14);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var schools = [
           { id: "136750", name: "Nicanor C. Ibuna Elementary School", lat: 14.60176124, lng: 121.0303504, programs: "K-6 Basic Education", address: "61 J.P. Rizal St. Brgy. Onse, San Juan City" },
            { id: "136744", name: "Pedro Cruz Elementary School", lat: 14.60551065, lng: 121.0263512, programs: "K-6 Basic Education", address: "114 Lope K. Santos St. Brgy. Pedro Cruz, San Juan City" },
            { id: "136751", name: "Pinaglabanan Elementary School", lat: 14.60401922, lng: 121.0299103, programs: "K-6 Basic Education, SPED", address: "Pinaglabanan St. Brgy. Corazon de Jesus, San Juan City" },
            { id: "136747", name: "San Perfecto Elementary School", lat: 14.60304465, lng: 121.0231903, programs: "K-6 Basic Education", address: "San Gabriel cor. Adevoso St. Brgy. San Perfecto, San Juan City" },
            { id: "136752", name: "Sta. Lucia Elementary School", lat: 14.59785905, lng: 121.0353281, programs: "K-6 Basic Education", address: "7-D Vicencio St. Brgy. Sta. Lucia, San Juan City" },
            { id: "137077", name: "West Crame Elementary School", lat: 14.60803024, lng: 121.0506251, programs: "K-6 Basic Education", address: "21 1st West Crame Street, Brgy. West Crame, San Juan City" },
            { id: "502655", name: "Kabayanan Integrated School", lat: 14.59879668, lng: 121.0316739, programs: "K-10 Integrated Basic Ed.", address: "201-I Francisco St. Brgy. Kabayanan, San Juan City" },
            { id: "502654", name: "Salapan Integrated School", lat: 14.6113472, lng: 121.0244919, programs: "K-10 Integrated Basic Ed.", address: "11-S Veloso St. Brgy. Salapan, San Juan City" },
            { id: "502653", name: "San Juan City Integrated School", lat: 14.60613459, lng: 121.0228738, programs: "K-10 Integrated Basic Ed.", address: "N. Domingo cor. A. Luna St. Brgy. Balong-Bato, San Juan City" },
            { id: "305423", name: "San Juan National High School", lat: 14.60558314, lng: 121.0294749, programs: "Junior - Senior High School (Grades 7-12)", address: "P. Narciso St. Brgy. Corazon de Jesus, San Juan City" },
            { id: "305607", name: "San Juan City Science High School", lat: 14.60369204, lng: 121.0314835, programs: "Science Curriculum (JHS & SHS)", address: "29 Pinaglabanan St. Brgy. St. Joseph, San Juan City" },
            { id: "305608", name: "San Juan City Academic Senior High School", lat: 14.60699842, lng: 121.0225635, programs: "SHS Academic Tracks", address: "N. Domingo cor. A. Luna St. Brgy. Balong-Bato, San Juan City" },
            { id: "305607", name: "San Juan City TVL Senior High School", lat: 14.60327769, lng: 121.0293973, programs: "SHS TVL Tracks", address: "Dr. A. Ejercito cor Jose Gil Street Brgy. Tibagan, San Juan City" }
        ];

        function getSchoolColor(name) {
            if (name.includes("Elementary")) return "#4285F4"; 
            if (name.includes("High School")) return "#EA4335"; 
            if (name.includes("Integrated")) return "#34A853"; 
            return "#FBBC05"; 
        }

        var datalist = document.getElementById('school-options');
        var searchInput = document.getElementById('schoolSearch');

        schools.forEach(function(school) {
            var schoolColor = getSchoolColor(school.name);
            
            var iconHtml = `<i class="fa-solid fa-school" style="color: ${schoolColor};"></i>`;
            var customIcon = L.divIcon({ html: iconHtml, className: 'custom-school-icon', iconSize: [30, 30], iconAnchor: [15, 15], popupAnchor: [0, -15] });
            
            var marker = L.marker([school.lat, school.lng], { icon: customIcon }).addTo(map);
            
            // NEW: Appended the "Get Directions" link at the bottom of the popup content.
            // Notice how it uses school.lat and school.lng to build the specific Google Maps URL.
            var popupContent = `
                <div class='badge' style='background-color: ${schoolColor}'>School Info</div>
                <div class='popup-title'><b>${school.name}</b></div>
                <div class='popup-id'>School ID: ${school.id}</div>
                <div class='popup-address'><i class="fa-solid fa-location-dot" style="color: #ea4335;"></i> ${school.address}</div>
                <div class='popup-programs'><b>Programs:</b> ${school.programs}</div>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${school.lat},${school.lng}" target="_blank" class="btn-directions">
                    <i class="fa-solid fa-route"></i> Get Directions
                </a>
            `;
            
            marker.bindPopup(popupContent);
            school.marker = marker;

            var option = document.createElement('option');
            option.value = school.name;
            datalist.appendChild(option);
        });

        searchInput.addEventListener('input', function(e) {
            var typedText = e.target.value;
            var matchedSchool = schools.find(function(s) { return s.name === typedText; });

            if (matchedSchool) {
                map.flyTo([matchedSchool.lat, matchedSchool.lng], 18, { animate: true, duration: 1.5 });
                matchedSchool.marker.openPopup();
                searchInput.value = '';
                searchInput.blur();
            }
        });

        var nominatimUrl = "https://nominatim.openstreetmap.org/search.php?q=San+Juan+City,+Metro+Manila,+Philippines&polygon_geojson=1&format=json";
        
        fetch(nominatimUrl)
            .then(function(response) { return response.json(); })
            .then(function(data) {
                if (data && data.length > 0) {
                    var cityBoundary = data[0].geojson;
                    L.geoJSON(cityBoundary, { style: { color: "#2c3e50", weight: 3, opacity: 0.7, fillOpacity: 0.05, dashArray: '8, 6' } }).addTo(map);
                }
            });

        var legend = L.control({ position: 'bottomright' });
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = `
                <h4>School Types</h4>
                <i class="fa-solid fa-school" style="color: #4285F4;"></i> Elementary School<br>
                <i class="fa-solid fa-school" style="color: #EA4335;"></i> High School<br>
                <i class="fa-solid fa-school" style="color: #34A853;"></i> Integrated School
            `;
            return div;
        };
        legend.addTo(map);

    </script>

</body>
</html>